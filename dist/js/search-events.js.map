{"version":3,"sources":["webpack://codefresh/./resources/assets/js/search-events.js"],"names":["target","this","searchBox","$","resultsWrapper","resultsDiv","searchIcon","searchField","clearIcon","window","isSpinnerVisible","isClearVisible","isSearchOn","maxPosts","IconSearch","IconSpiner","previousValue","typingTimer","events","on","typingLogic","bind","navStart","navList","closeSearchEsc","clear","closeResults","e","keyCode","indexOf","preventDefault","stopPropagation","is","focus","parent","next","find","prev","minilist","children","first","last","val","clearTimeout","html","setTimeout","getResults","removeClass","addClass","query","r","XMLHttpRequest","open","ajax_object","ajax_url","setRequestHeader","onreadystatechange","readyState","status","responseText","send","classList","contains","tagName","toLowerCase"],"mappings":"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","file":"/js/search-events.js","sourcesContent":["class Search {\n  constructor( target ) {\n    this.target = target;\n    this.searchBox = $( `${ this.target }` );\n    this.resultsWrapper = $( `${ this.target } .search__results` );\n    this.resultsDiv = $( `${ this.target } .search-results-inner` );\n    this.searchIcon = $( `${ this.target } .search__icon--search` );\n    this.searchField = $( `${ this.target } .search__input` );\n\n    this.clearIcon = $( `${ this.target } .search__icon--clear` );\n\n    this.window = $( window );\n    this.isSpinnerVisible = false;\n    this.isClearVisible = false;\n    this.isSearchOn = false;\n    this.maxPosts = 30;\n    this.IconSearch = '<i class=\"fas fa-search\"></i>';\n    this.IconSpiner = '<i class=\"fas fa-spinner-third fa-spin\"></i>';\n    this.previousValue;\n    this.typingTimer;\n    this.events();\n  }\n\n  events () {\n    this.searchField.on( 'keyup', this.typingLogic.bind( this ) );\n    this.searchField.on( 'keydown', this.navStart.bind( this ) );\n    this.window.on( 'keydown', this.navList.bind( this ) );\n    this.window.on( 'keyup', this.closeSearchEsc.bind( this ) );\n    this.clearIcon.on( 'click', this.clear.bind( this ) );\n    this.window.on( 'click', this.closeResults.bind( this ) );\n  }\n\n  closeSearchEsc ( e ) {\n    if ( e.keyCode == 27 ) {\n      if ( this.isSearchOn ) {\n        this.clear();\n      }\n    }\n  }\n\n  navList ( e ) {\n\n    if ( [ 38, 40 ].indexOf( e.keyCode ) == -1 ) {\n      return;\n    }\n\n    switch ( e.keyCode ) {\n\n      case 40: // Key down\n        e.preventDefault();\n        e.stopPropagation();\n\n        if ( !$( '.search__minilist li:last a' ).is( ':focus' ) ) {\n          $( ':focus' ).parent().next().find( 'a' ).focus();\n        } else {\n          this.searchField.focus();\n        }\n        break;\n\n      case 38: // Key up\n        e.preventDefault();\n        e.stopPropagation();\n\n        if ( !$( '.search__minilist li:first a' ).is( ':focus' ) ) {\n          $( ':focus' ).parent().prev().find( 'a' ).focus();\n        } else {\n          this.searchField.focus();\n        }\n        break;\n    }\n  }\n\n  navStart ( e ) {\n    const minilist = $( '.search__minilist' );\n\n    if ( [ 38, 40 ].indexOf( e.keyCode ) == -1 ) {\n      return;\n    }\n\n    if ( this.isSearchOn ) {\n      if ( this.searchField.is( ':focus' ) ) {\n        switch ( e.keyCode ) {\n          case 40: // Key down\n            e.preventDefault();\n            e.stopPropagation();\n\n            minilist.children().first().find( 'a' ).focus();\n            break;\n          case 38: // Key up\n            e.preventDefault();\n            e.stopPropagation();\n\n            minilist.children().last().find( 'a' ).focus();\n            break;\n        }\n      }\n    }\n  }\n\n  typingLogic () {\n    if ( this.searchField.val() != this.previousValue ) {\n\n      clearTimeout( this.typingTimer );\n\n      if ( this.searchField.val() ) {\n\n        if ( !this.isSpinnerVisible ) {\n          this.searchIcon.html( this.IconSpiner );\n          this.isSpinnerVisible = true;\n        }\n        this.typingTimer = setTimeout( this.getResults.bind( this ), 200 );\n\n      } else {\n        this.searchIcon.html( this.IconSearch );\n        this.isSpinnerVisible = false;\n        this.resultsWrapper.removeClass( 'block' );\n      }\n\n      if ( !this.isClearVisible ) {\n        this.clearIcon.addClass( 'block' );\n        this.isClearVisible = true;\n      }\n\n      if ( this.isClearVisible && this.searchField.val() === '' ) {\n        this.clearIcon.removeClass( 'block' );\n        this.isClearVisible = false;\n      }\n    }\n    this.previousValue = this.searchField.val();\n  }\n\n  getResults () {\n    const query = this.searchField.val();\n    const r = new XMLHttpRequest();\n    r.open( 'POST', ajax_object.ajax_url ); // eslint-disable-line no-undef\n    r.setRequestHeader( 'Content-Type', 'application/x-www-form-urlencoded;' );\n    r.onreadystatechange = () => {\n      if ( r.readyState !== 4 || r.status !== 200 ) {\n        return;\n      }\n\n      // Render list\n      this.resultsDiv.html( r.responseText );\n      this.searchIcon.html( this.IconSearch );\n      this.isSpinnerVisible = false;\n      this.isSearchOn = true;\n      this.resultsWrapper.addClass( 'block' );\n    };\n    r.send( 'action=cf_search_events&query=' + query );\n  }\n\n  closeResults ( e ) {\n    if (\n      this.isSearchOn &&\n      !e.target.classList.contains( 'search__icon--clear' ) &&\n      !e.target.classList.contains( 'search__input' ) &&\n      !e.target.classList.contains( 'btn-search' ) ||\n      !e.target.tagName.toLowerCase() === 'a'\n    ) {\n      $( '.search__results' ).removeClass( 'block' );\n    }\n  }\n\n  clear () {\n    $( '.search__results' ).removeClass( 'block' );\n    this.isClearVisible = false;\n    this.searchField.val( '' );\n    this.searchField.focus();\n    this.clearIcon.removeClass( 'block' );\n  }\n\n  failedToFetchPosts () {\n    this.resultsWrapper.addClass( 'block' );\n    this.resultsDiv.html( '<span class=\"search__no-results\">Something went wrong. Please try again :(</span>' );\n    this.searchIcon.html( this.IconSearch );\n    this.isSpinnerVisible = false;\n  }\n}\n\nnew Search( '#search' );\n"],"sourceRoot":""}